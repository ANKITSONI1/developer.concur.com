# only trigger ci for dev and master branches
branches:
  only:
    - preview
    - livesite

# language setting
language: ruby

# version numbers
rvm:
  - ruby-head

env:
  global:
    - secure: ZL5P4KACDJHWmhW2OSNhcse2/mjufb5hPu6iFbCWvNIGtLNju8ZtYRwa0lk6ii91xyDQXeeWEBr8pTJcti/KKbk1WQ/2iCGle2RYJSAAgjxDu9WJ/Z60hmaY5m8NYrhdwHqNSMk0Gay16y1vizKX7Su1MuJ1s7anbKHmvKm2tHWCHINdzCqFOy72Bq5dILIeK704S5jdB9vw2QyrzPSoet4gWhosEKiDZH/4UljXsJ38QisBmdkX5yGgSISApp9GUH0TV/HvbDpEGyVh+GNpvZsqecp0ixjyNE3NQlQagXTJDk9dFZyClf5XoLesh7DjR+63pvCWExSrjEMDI0b13w==
    - secure: MuiaqeSpKTDE5IvkmScp0tEkFQd7/FKT9ABg3FYjhq55tDp5CkslULtkziN7hzHPLYd0FyH4jX7J+XCd/yVjDdkKTLQbaX7bX8/IS8Tl7+myhd1ORzf1LqPxbKUpTaWGSWqpy+As/zz30FoD/gm27aMtRfohlpFcIEJlQdRDa27Y1KKMIzU19DJYl15L0TIPY8L3HR9ufG+5xN4RrfcO2cGlVORpGIuDLXqFJKtK8tRuZCY+zcV/GkqYRJGRBerEs87SVhwdoQYE5k+U1cu/fkWFIqw6V2/wwCdyle97auxKa2q9rqtiw5ww70nhnDDMsOxwY3PWLEQIDYkCxurDuA==
    - secure: ehF5ZkTBkJdFGtbMZYkLL8vnpKh3nNcUru/dx2pzMeZTuSJaAiuLw3vo2jBkpWhSI4PDuSR/dzwZLy9hm2KddSyQ42wZGbBJQtwVtFlvRoQ8+s7I7zS3wcJhKgb0qGkjTFdq7JsyPHAPyhAAhPRe7fb9xLwT3pbJUl7zweF4sbGo9CEfwqOXm4GOLh+ArG76+yshgZCWJxmibNBn9G1gxmZTA9X6BkXniQtqU3B9+3gFE0P8DHZmIi7awQU1MeVdGI8RGLB62xxmazzeFvy9lluarIxGy528Qtn1Ie1Yoz+Trn0V6CCMoxLo8nxOmb1AOGN6m72BAQoxfyYcB7fNbQ== #aws
    - SLACK_ORG=ConcurCTO 
    - PROJECT=Developer-Portal

# install system dependencies (AWS CLI + jekyll)
install:
  - ./build/install_aws_cli.sh
  - gem install jekyll

before_script:
  # - ./build/aws_cli_config.sh
  - bundle install

script:
  - ./build/write_commit.sh
  - bundle exec jekyll build
  - aws s3 sync ./_site s3://preview.developer.concur.com --region us-west-2 --output text --delete

after_failure:
  - python ./build/slack_notifier.py --project $PROJECT --org $SLACK_ORG --token $SLACK_TOKEN

after_success:
  - python ./build/slack_notifier.py --project $PROJECT --org $SLACK_ORG --token $SLACK_TOKEN -s
