# only trigger ci for dev and master branches
branches:
  only:
    - preview
    - livesite

env:
  global:
    - secure: ZL5P4KACDJHWmhW2OSNhcse2/mjufb5hPu6iFbCWvNIGtLNju8ZtYRwa0lk6ii91xyDQXeeWEBr8pTJcti/KKbk1WQ/2iCGle2RYJSAAgjxDu9WJ/Z60hmaY5m8NYrhdwHqNSMk0Gay16y1vizKX7Su1MuJ1s7anbKHmvKm2tHWCHINdzCqFOy72Bq5dILIeK704S5jdB9vw2QyrzPSoet4gWhosEKiDZH/4UljXsJ38QisBmdkX5yGgSISApp9GUH0TV/HvbDpEGyVh+GNpvZsqecp0ixjyNE3NQlQagXTJDk9dFZyClf5XoLesh7DjR+63pvCWExSrjEMDI0b13w==
    - secure: MuiaqeSpKTDE5IvkmScp0tEkFQd7/FKT9ABg3FYjhq55tDp5CkslULtkziN7hzHPLYd0FyH4jX7J+XCd/yVjDdkKTLQbaX7bX8/IS8Tl7+myhd1ORzf1LqPxbKUpTaWGSWqpy+As/zz30FoD/gm27aMtRfohlpFcIEJlQdRDa27Y1KKMIzU19DJYl15L0TIPY8L3HR9ufG+5xN4RrfcO2cGlVORpGIuDLXqFJKtK8tRuZCY+zcV/GkqYRJGRBerEs87SVhwdoQYE5k+U1cu/fkWFIqw6V2/wwCdyle97auxKa2q9rqtiw5ww70nhnDDMsOxwY3PWLEQIDYkCxurDuA==
    - secure: W2iN7si9B/UnyZzIN+hsPPUiZ9RLV70TU5pNTkraDaOghxi5FaaqR/sq7dfqKYZaGTllcSDsrcVTREIdS0hprffAhIgEM8j8N+sADRpyKOP157PgMdtvg+thLjkaTHi9gmzEgT7EQdIw7fTC0vzNVlH9FXdmwDIjQD4fDDme3o+baWQclLktRIWE7Qmx1Yq6r9ew32qAee6GmXfDbl9djS96zbN50CKlSPjcvAB8SdZ5MLJTSUSds9wq6788WZtgPI7ZOrW2rupTgK2OBJHCsM6tSECJkFP8QSTZLKmt0QQgo6nY+tgwMg83y1hCJiSWiZLv4gk4IVAElWC2vjsEbg== #aws
    - SLACK_ORG=ConcurCTO 
    - PROJECT=Developer-Portal

# install system dependencies (AWS CLI + jekyll)
install:
  - ./build/install_aws_cli.sh
  - gem install jekyll

  before-script:
  - mkdir ~/.aws
  - ./build/aws_cli_config.sh

script:
  - ./build/write_commit.sh
  - bundle exec jekyll build

after_failure:
  - python ./build/slack_notifier.py --project $PROJECT --org $SLACK_ORG --token $SLACK_TOKEN

after_success:
  - aws s3 sync ./site s3://preview.developer.concur.com --delete
  - python ./build/slack_notifier.py --project $PROJECT --org $SLACK_ORG --token $SLACK_TOKEN -s
